(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{345:function(e,v,_){"use strict";_.r(v);var o=_(0),r=Object(o.a)({},(function(){var e=this,v=e.$createElement,_=e._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("h1",{attrs:{id:"循环依赖"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#循环依赖"}},[e._v("#")]),e._v(" 循环依赖")]),e._v(" "),_("p",[e._v("  此时有两个类"),_("code",[e._v("AService")]),e._v("和"),_("code",[e._v("BService")]),e._v("，两个类之间互相依赖，并且被切面。在Spring启动过程中，是这样解决循环依赖问题的。")]),e._v(" "),_("p",[_("font",{attrs:{color:"red"}},[e._v("（1）假设首先实例化"),_("code",[e._v("AService")]),e._v("，将实例化后的bean加入到三级缓存"),_("code",[e._v("singletonFactories")]),e._v("中。")])],1),e._v(" "),_("p",[_("font",{attrs:{color:"red"}},[e._v("（2）紧接着填充"),_("code",[e._v("AService")]),e._v("实例的属性。当填充"),_("code",[e._v("BService")]),e._v("属性时。Spring就会在单例池中寻找，发现还未进行初始化，继而触发"),_("code",[e._v("BService")]),e._v("的实例化过程。")])],1),e._v(" "),_("p",[_("font",{attrs:{color:"blue"}},[e._v("（3）同样首先实例化"),_("code",[e._v("BService")]),e._v("，将实例化后的bean加入到三级缓存"),_("code",[e._v("singletonFactories")]),e._v("中。")])],1),e._v(" "),_("p",[_("font",{attrs:{color:"blue"}},[e._v("（4）紧接着填充"),_("code",[e._v("BService")]),e._v("实例的属性，当填充"),_("code",[e._v("AService")]),e._v("属性时。Spring就会在单例池中寻找，发现其正在进行初始化，就会将其在一级缓存中拿出来，进行早期引用的处理，完成后将其加入到二级缓存"),_("code",[e._v("earlySingletonObjects")]),e._v("中，返回一个早期的单例引用。"),_("code",[e._v("BService")]),e._v("实例完成了"),_("code",[e._v("AService")]),e._v("属性的填充。")])],1),e._v(" "),_("p",[_("font",{attrs:{color:"blue"}},[e._v("（5）紧接着"),_("code",[e._v("BService")]),e._v("实例进行初始化，开始执行各种前置处理器和后置处理器，这里也形成了最终的AOP对象（各类切面）。")])],1),e._v(" "),_("p",[_("font",{attrs:{color:"blue"}},[e._v("（6）最后将"),_("code",[e._v("BService")]),e._v("实例加入到单例池（一级缓存）"),_("code",[e._v("singletonObjects")]),e._v("中，到此"),_("code",[e._v("BService")]),e._v("完成了整个实例化过程。")])],1),e._v(" "),_("p",[_("font",{attrs:{color:"red"}},[e._v("（7）"),_("code",[e._v("AService")]),e._v("实例等了好久，终于拿到了已经完成初始化的"),_("code",[e._v("BService")]),e._v("实例，完成了属性注入。")])],1),e._v(" "),_("p",[_("font",{attrs:{color:"red"}},[e._v("（8）"),_("code",[e._v("AService")]),e._v("实例继续进行初始化过程，开始执行各种前置处理器和后置处理器（后置处理器中有一个特殊处理，由于之前生成过早期的引用对象，在这里不会重复生成代理对象）。")])],1),e._v(" "),_("p",[_("font",{attrs:{color:"red"}},[e._v("（9）最后"),_("code",[e._v("AService")]),e._v("判断了一下，以前执行过早期的引用处理，在二级缓存中拿出早期的代理对象，覆盖当前"),_("code",[e._v("AService")]),e._v("的实例。")])],1),e._v(" "),_("p",[_("font",{attrs:{color:"red"}},[e._v("（10）最后"),_("code",[e._v("AService")]),e._v("实例被加入了单例池中，解决了循环依赖。")])],1)])}),[],!1,null,null,null);v.default=r.exports}}]);