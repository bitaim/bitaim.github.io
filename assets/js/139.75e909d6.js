(window.webpackJsonp=window.webpackJsonp||[]).push([[139],{338:function(e,a,c){"use strict";c.r(a);var v=c(0),_=Object(v.a)({},(function(){var e=this,a=e.$createElement,c=e._self._c||a;return c("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[c("h1",{attrs:{id:"文件读写"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#文件读写"}},[e._v("#")]),e._v(" 文件读写")]),e._v(" "),c("p",[e._v("  选择合适的文件读写方式是十分重要的，常见的文件读写方式有如下三种。")]),e._v(" "),c("ol",[c("li",[e._v("传统的BIO方式，例如："),c("code",[e._v("FileInputStream")]),e._v("、"),c("code",[e._v("FileOutputStream")]),e._v("等。")]),e._v(" "),c("li",[e._v("NIO下的文件通道 "),c("code",[e._v("FileChannel")]),e._v("。即使在NIO包下，同样是阻塞的。")]),e._v(" "),c("li",[e._v("基于内存映射方式的MMAP "),c("code",[e._v("MappedByteBuffer")]),e._v("。通过文件通道 "),c("code",[e._v("FileChannel")]),e._v("调用map方法衍生出来的一种特殊的文件读写方式。")])]),e._v(" "),c("h3",{attrs:{id:"page-cache"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#page-cache"}},[e._v("#")]),e._v(" page cache")]),e._v(" "),c("p",[e._v("  内核会为每一个文件维护一个page cache，用户进程对于文件的大多数读写操作会直接作用在page cache上，内核会选择适当的时候将page cache中的内容写到磁盘上，也可以手动调用fsync控制回写。使用page cache可以大大减少访问磁盘的次数，从而提高性能。")]),e._v(" "),c("p",[e._v("  page cache缓存文件的内容，并且以页为单位，当写文件也需要以页为单位进行写入。")]),e._v(" "),c("h3",{attrs:{id:"顺序读写与随机读写"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#顺序读写与随机读写"}},[e._v("#")]),e._v(" 顺序读写与随机读写")]),e._v(" "),c("p",[e._v("  无论是机械硬盘还是固态硬盘，顺序读写比随机读写都要快。")]),e._v(" "),c("p",[e._v("  根本原因是，就是操作系统中的"),c("code",[e._v("page cache")]),e._v("在起作用，它是用户内存与磁盘之间的一层缓存。")]),e._v(" "),c("p",[e._v("  当通过"),c("code",[e._v("fileChannel.read(4kb)")]),e._v("读取数据时，实际上操作系统从磁盘加载了16KB的数据进入"),c("code",[e._v("page cache")]),e._v("，这被称为"),c("strong",[e._v("预读")]),e._v("。操作系统从page cache中拷贝4kb的数据到用户内存。")]),e._v(" "),c("p",[e._v("  当用户继续顺序访问时，磁盘上的数据已经存在于page cache中了，就不需要再去访问磁盘了。由于磁盘和内存的速度相差很大，由四次磁盘IO变成一次磁盘IO和四次内存IO，后者的性能更快，这都是page cache带来的优化。")])])}),[],!1,null,null,null);a.default=_.exports}}]);